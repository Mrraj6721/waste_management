{% extends 'reports/base.html' %}

{% block title %}Report #{{ report.id }} - Community Waste Reporting{% endblock %}

{% block extra_css %}
<style>
    .report-detail {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    
    @media (max-width: 768px) {
        .report-detail {
            grid-template-columns: 1fr;
        }
    }
    
    .report-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .detail-section {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 1rem;
    }
    
    .detail-section h3 {
        color: #495057;
        margin-bottom: 1rem;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 0.5rem;
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .detail-label {
        font-weight: 600;
        color: #495057;
    }
    
    .detail-value {
        color: #6c757d;
    }
    
    .map-container {
        height: 300px;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1>üìã Waste Report #{{ report.id }}</h1>
        <p>Detailed information about this waste report</p>
    </div>
    
    <div class="card-body">
        <div class="report-detail">
            <!-- Image Section -->
            <div>
                <div class="detail-section">
                    <h3>üì∏ Report Image</h3>
                    {% if report.image %}
                        <img src="{{ report.image.url }}" alt="Waste Image" class="report-image">
                    {% else %}
                        <p>No image available</p>
                    {% endif %}
                </div>
                
                <!-- Location Map -->
                <div class="detail-section">
                    <h3>üó∫Ô∏è Location</h3>
                    <div id="map" class="map-container"></div>
                </div>
            </div>
            
            <!-- Details Section -->
            <div>
                <!-- Basic Information -->
                <div class="detail-section">
                    <h3>üìã Basic Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Report ID:</span>
                        <span class="detail-value">#{{ report.id }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value">
                            <span class="badge badge-{{ report.status }}">
                                {{ report.get_status_display }}
                            </span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Severity:</span>
                        <span class="detail-value">
                            <span class="badge badge-{{ report.severity }}">
                                {{ report.get_severity_display }}
                            </span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Waste Type:</span>
                        <span class="detail-value">{{ report.get_waste_type_display }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">AI Confidence:</span>
                        <span class="detail-value">{{ report.confidence|floatformat:1 }}%</span>
                    </div>
                </div>
                
                <!-- Location Information -->
                <div class="detail-section">
                    <h3>üìç Location Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span class="detail-value">
                            {% if report.address %}
                                {{ report.address }}
                            {% else %}
                                Not available
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Coordinates:</span>
                        <span class="detail-value">
                            {{ report.location_lat|floatformat:6 }}, {{ report.location_lng|floatformat:6 }}
                        </span>
                    </div>
                </div>
                
                <!-- Report Details -->
                <div class="detail-section">
                    <h3>üìù Report Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Description:</span>
                        <span class="detail-value">
                            {% if report.description %}
                                {{ report.description }}
                            {% else %}
                                No description provided
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Reported By:</span>
                        <span class="detail-value">
                            {% if report.reported_by %}
                                {{ report.reported_by.username }}
                            {% else %}
                                Anonymous
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Reported At:</span>
                        <span class="detail-value">{{ report.reported_at|date:"F d, Y H:i" }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Last Updated:</span>
                        <span class="detail-value">{{ report.updated_at|date:"F d, Y H:i" }}</span>
                    </div>
                </div>
                
                <!-- Authority Information -->
                <div class="detail-section">
                    <h3>üèõÔ∏è Authority Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Notified Authorities:</span>
                        <span class="detail-value">
                            {% if report.notified_authorities %}
                                ‚úÖ Yes
                            {% else %}
                                ‚ùå No
                            {% endif %}
                        </span>
                    </div>
                    {% if report.authority_response %}
                    <div class="detail-row">
                        <span class="detail-label">Authority Response:</span>
                        <span class="detail-value">{{ report.authority_response }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Actions -->
                <div class="detail-section">
                    <h3>‚öôÔ∏è Actions</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
                        <form method="post" action="{% url 'update_report_status' report.id %}" style="display: inline;">
                            {% csrf_token %}
                            <select name="status" class="form-control" style="width: auto; display: inline-block;">
                                {% for value, label in report.STATUS_CHOICES %}
                                    <option value="{{ value }}" {% if report.status == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn">Update Status</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize map
    var map = L.map('map').setView([{{ report.location_lat }}, {{ report.location_lng }}], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // Add marker for this report
    L.marker([{{ report.location_lat }}, {{ report.location_lng }}])
        .addTo(map)
        .bindPopup(`
            <div style="min-width: 200px;">
                <h4>Waste Report #{{ report.id }}</h4>
                <p><strong>Type:</strong> {{ report.get_waste_type_display }}</p>
                <p><strong>Severity:</strong> {{ report.get_severity_display }}</p>
                <p><strong>Status:</strong> {{ report.get_status_display }}</p>
            </div>
        `)
        .openPopup();
</script>
{% endblock %}
